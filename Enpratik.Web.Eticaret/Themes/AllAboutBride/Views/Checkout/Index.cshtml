@model List<Enpratik.Data.Product_BasketItem>
@using Enpratik.Core;
@using Enpratik.Web.Eticaret.Model;
@{
    ViewBag.Title = "Index";

    double subTotal = 0;
    double cargoTotal = 20;
    Enpratik.Data.EnPratik_DataHelper db = new Enpratik.Data.EnPratik_DataHelper();
}


<style>
    .size19 {
        max-width: 100% !important;
    }
</style>

@using (Html.BeginForm("Index","Checkout", FormMethod.Post, new { id="frmCheckout" }))
{
    <div class="section section-checkout pt-7 pb-7">
        <div class="container">
            <div class="row">
                <div class="col-md-6 p-b-30">

                    <div style="padding:30px; border:1px solid #eee;">

                        <h4 class="m-text25 p-b-14">
                            Kullanıcı Bilgileri
                        </h4>
                        <p class="s-text8 p-b-10" style="color:#000000">
                            Satın alma işlemi için lütfen aşağıdaki bilgileri doldurunuz!
                        </p>

                        @if (ViewBag.ErrorMessage != null)
                        {
                            <p class="s-text8 p-b-10" style="color:#ff0000">
                               @ViewBag.ErrorMessage
                            </p>
                        }
                            <div class="bo12 of-hidden size19 m-b-20">
                                <input name="Name" type="hidden" value="@Current.User.FirstName" />
                                <input class="sizefull s-text7 p-l-18 p-r-18" type="text" disabled="disabled" placeholder="İsim *" value="@Current.User.FirstName" />
                            </div>

                            <div class="bo12 of-hidden size19 m-b-20">
                                <input name="Surname" type="hidden" value="@Current.User.LastName" />
                                <input type="text" class="sizefull s-text7 p-l-18 p-r-18" disabled="disabled" placeholder="Soyisim *" value="@Current.User.LastName" />
                            </div>
                            <div class="bo12 of-hidden size19 m-b-20">
                                <input name="Email" type="hidden" value="@Current.User.Mail" />
                                <input disabled="disabled" type="text" class="sizefull s-text7 p-l-18 p-r-18" placeholder="Email *" value="@Current.User.Mail" />
                            </div>
                        <div class="bo12 of-hidden size19 m-b-20">
                            <input name="IdentityNumber" type="text" class="sizefull s-text7 p-l-18 p-r-18" placeholder="Tc Kimlik No *" value="" />
                        </div>
                        <div class="bo12 of-hidden size19 m-b-20">
                            <input name="GsmNumber" type="text" class="sizefull s-text7 p-l-18 p-r-18" placeholder="Cep telefonu *" value="" />
                        </div>

                        <h4 class="m-text25 p-b-14">
                            Teslimat Adresi
                        </h4>

                        <div class="bo12 of-hidden size19 m-b-20">
                            <textarea name="TeslimatAdres" rows="3" class="sizefull s-text7 p-l-18 p-r-18" placeholder="Adres *" value=""></textarea>
                        </div>

                        <h4 class="m-text25 p-b-14">
                            Fatura Adresi
                        </h4>
                        <div class="bo12 of-hidden size19 m-b-20">
                            <textarea name="FaturaAdres" rows="3" class="sizefull s-text7 p-l-18 p-r-18" placeholder="Adres *" value=""></textarea>
                        </div>


                        <div id="iyzipay-checkout-form" class="popup"></div>

                    </div>
                </div>

                <div class="col-md-6 p-b-30">

                    <div class="leave-comment">
                        <div style="padding:30px; border:1px solid #eee;">
                            <h4 class="m-text25 p-b-14">
                                Sepet Tutarı
                            </h4>

                            <div class="flex-w flex-sb-m p-b-12">
                                @foreach (var item in Model)
                                {

                                    var product = item.GetProduct();

                                    @Html.Hidden("ProductId", item.ProductId)
                                    <span class="s-text18 w-size19 w-full-sm">
                                        @product.ProductName &nbsp;<strong class="product-quantity">× @item.Quantity </strong>
                                    </span>
                                    <span class="m-text21 w-size20 w-full-sm">
                                        @Enpratik.Core.Functions.MoneyFormat(2, product.Price * item.Quantity) ₺
                                    </span>
                                    subTotal += (Convert.ToDouble(product.Price) * item.Quantity);
                                }

                                <hr />


                                <span class="s-text18 w-size19 w-full-sm">
                                    Ara Toplam:
                                </span>

                                <span class="m-text21 w-size20 w-full-sm">
                                    @subTotal ₺
                                </span>

                                <span class="s-text18 w-size19 w-full-sm">
                                    Kargo Ücreti:
                                </span>

                                <span class="m-text21 w-size20 w-full-sm">
                                    @cargoTotal ₺
                                </span>
                            </div>

                            <!--  -->
                            <div class="flex-w flex-sb-m p-t-26 p-b-30">
                                <span class="m-text22 w-size19 w-full-sm">
                                    Toplam:
                                </span>

                                <span class="m-text21 w-size20 w-full-sm">
                                    @(subTotal + cargoTotal) ₺
                                    <input type="hidden" name="subPrice" value="@subTotal" />
                                    <input type="hidden" name="totalPrice" value="@(subTotal + cargoTotal)" />
                                </span>
                            </div>

                            <div class="size15 trans-0-4">

                                <input type="checkbox" name="chkMesafeliSatisSozlesmesi" id="chkMesafeliSatisSozlesmesi" /> <a target="_blank" href="/mesafeli-satis-sozlesmesi" onclick="$('#chkMesafeliSatisSozlesmesi').prop('checked', true);">Mesafeli Satış Sözleşmesini Okudum, Onaylıyorum</a>
                            </div>
                            <div class="size15 trans-0-4">

                                <!-- Button -->
                                <button type="submit" class="flex-c-m sizefull bg1 bo-rad-23 hov1 s-text1 trans-0-4">
                                    Ödeme İşlemİnİ Yap
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
}
@if (ViewBag.CheckoutFormContent != null)
{
    @Html.Raw(ViewBag.CheckoutFormContent)
}