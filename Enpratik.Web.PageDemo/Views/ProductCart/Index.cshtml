@model List<Enpratik.Data.Product_BasketItem>
@using Enpratik.Core;
@{
    ViewBag.Title = "Index";

    double subTotal = 0;
    double cargoTotal = 11.50;

    Enpratik.Data.EnPratik_DataHelper db = new Enpratik.Data.EnPratik_DataHelper();
}

    <div class="breacrumb-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb-text product-more">
                        <a href="/"><i class="fa fa-home"></i> Anasayfa</a>
                        <span>Sepetim</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <section class="shopping-cart spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    @if (Model.Count == 0)
                    {
                        <div class="cart-table">
                            <h4 style="color:#e23030">** Sepetinizde ürün bulunmamaktadır.</h4>
                        </div>
                    }
                    else
                    {
                        using (Html.BeginForm())
                        {
                            int itemIndex = 0;

                            <div class="cart-table">

                                <table>
                                    <tbody>

                                        @foreach (var item in Model)
                                        {
                                            var product = item.GetProduct();

                                            var images = db.Product_Picture_Mapping.Where(p => p.ProductId == product.Id & p.IsProductImage == true).FirstOrDefault();

                                            @Html.Hidden("ProductId", item.ProductId)


                                            var productUrl = "product/" + product.getUrl() + "-" + product.Id;

                                            <tr>
                                                <td class="cart-pic first-row"><img src="@Functions.GetProductImages(images)" onerror="this.src = 'https://www.enpratik.net/img/no-image.png'" alt=""></td>
                                                <td class="cart-title first-row">
                                                    <h5>@product.ProductName</h5>
                                                </td>
                                                <td class="p-price first-row">@Functions.MoneyFormat(2, item.Price)</td>
                                                <td class="qua-col first-row">
                                                    <div class="quantity">
                                                        <div class="pro-qty">
                                                            <input type="number" min="1" name="Quantity" value="@item.Quantity" size="4">
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="total-price first-row">@Enpratik.Core.Functions.MoneyFormat(2, item.Price * item.Quantity) ₺</td>
                                                <td class="close-td first-row"><a style="cursor:pointer;" onclick="cartRemove(@itemIndex);"><i class="ti-close"></i></a></td>
                                            </tr>

                                            subTotal += (Convert.ToDouble(item.Price) * item.Quantity);
                                            itemIndex++;
                                        }

                                    </tbody>
                                </table>

                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="cart-buttons">
                                        <a href="/urunler" class="primary-btn continue-shop">Alışverişe Devam Et</a>
                                        <input type="submit" class="primary-btn up-cart" name="update_cart" value="Sepeti Güncelle" />
                                    </div>
                                    @*<div class="discount-coupon">
                            <h6>Discount Codes</h6>
                            <form action="#" class="coupon-form">
                                <input type="text" placeholder="Enter your codes">
                                <button type="submit" class="site-btn coupon-btn">Apply</button>
                            </form>
                        </div>*@
                                </div>
                                <div class="col-lg-6 offset-lg-4">
                                    <div class="proceed-checkout">
                                        <ul>
                                            <li class="subtotal">Ara Toplam <span>@Functions.MoneyFormat(2, subTotal) ₺</span></li>
                                            <li class="subtotal">Kargo Ücreti <span>@Functions.MoneyFormat(2, cargoTotal) ₺</span></li>
                                            <li class="cart-total">Toplam Tutar <span>@Functions.MoneyFormat(2, (subTotal + cargoTotal)) ₺</span></li>
                                        </ul>
                                        <a href="@Url.Action("Index","Checkout")" class="proceed-btn">Ödeme Yap</a>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
    </section>

<form style="display:none;" id="frmRemove" method="post" action="@Url.Action("Remove","ProductCart")">
    <input type="hidden" name="itemIndex" id="itemIndex" />
    <input type="submit" id="btnRemove" style="display:none;" />
</form>

<script type="text/javascript">

    function cartRemove(itemNo) {

        $("#itemIndex").val(itemNo);
        $("#btnRemove").click();

    }

</script>